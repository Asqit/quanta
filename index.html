<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Pomodoro Config</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: system-ui, sans-serif;
                padding: 20px;
                max-width: 400px;
                margin: 0 auto;
                background: #f5f5f5;
            }
            .card {
                background: #fff;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
                color: #333;
            }
            .field {
                margin-bottom: 15px;
            }
            label {
                display: block;
                margin-bottom: 5px;
                color: #666;
                font-size: 14px;
            }
            input[type="number"] {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 16px;
            }
            .checkbox {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .checkbox input {
                width: auto;
            }
            button {
                width: 100%;
                padding: 12px;
                background: #007bff;
                color: #fff;
                border: none;
                border-radius: 4px;
                font-size: 16px;
                cursor: pointer;
                margin-top: 10px;
            }
            button:hover {
                background: #0056b3;
            }
            .status {
                padding: 10px;
                border-radius: 4px;
                margin-top: 10px;
                display: none;
            }
            .status.success {
                background: #d4edda;
                color: #155724;
                display: block;
            }
            .status.error {
                background: #f8d7da;
                color: #721c24;
                display: block;
            }
        </style>
    </head>
    <body>
        <div class="card">
            <h1>Quanta Settings</h1>
            <form id="configForm">
                <div class="field">
                    <label>Work Duration (min)</label>
                    <input
                        type="number"
                        name="work"
                        min="1"
                        max="120"
                        required
                    />
                </div>
                <div class="field">
                    <label>Short Break (min)</label>
                    <input
                        type="number"
                        name="short_break"
                        min="1"
                        max="60"
                        required
                    />
                </div>
                <div class="field">
                    <label>Long Break (min)</label>
                    <input
                        type="number"
                        name="long_break"
                        min="1"
                        max="120"
                        required
                    />
                </div>
                <div class="field checkbox">
                    <input type="checkbox" name="auto_start_breaks" id="asb" />
                    <label for="asb">Auto-start breaks</label>
                </div>
                <div class="field checkbox">
                    <input type="checkbox" name="auto_start_work" id="asw" />
                    <label for="asw">Auto-start work</label>
                </div>
                <div class="field checkbox">
                    <input type="checkbox" name="sounds" id="snd" />
                    <label for="snd">Enable sounds</label>
                </div>
                <button type="submit">Save Configuration</button>
                <div class="status" id="status"></div>
            </form>
        </div>
        <script>
            const form = document.getElementById("configForm");
            const status = document.getElementById("status");

            // Load current config
            fetch("/config")
                .then((r) => r.json())
                .then((d) => {
                    form.work.value = d.work;
                    form.short_break.value = d.short_break;
                    form.long_break.value = d.long_break;
                    form.auto_start_breaks.checked = d.auto_start_breaks;
                    form.auto_start_work.checked = d.auto_start_work;
                    form.sounds.checked = d.sounds;
                })
                .catch((e) => console.error(e));

            form.onsubmit = async (e) => {
                e.preventDefault();
                status.className = "status";
                status.textContent = "";
                const data = {
                    timing: {
                        work: +form.work.value,
                        short_break: +form.short_break.value,
                        long_break: +form.long_break.value,
                    },
                    behavior: {
                        auto_start_breaks: form.auto_start_breaks.checked,
                        auto_start_work: form.auto_start_work.checked,
                    },
                    settings: {
                        sounds: form.sounds.checked,
                    },
                };
                try {
                    const r = await fetch("/", {
                        method: "POST",
                        body: JSON.stringify(data),
                    });
                    if (r.ok) {
                        status.className = "status success";
                        status.textContent =
                            "✓ Configuration saved! Device will restart.";
                    } else {
                        throw new Error("Failed");
                    }
                } catch (e) {
                    status.className = "status error";
                    status.textContent = "✗ Failed to save configuration";
                }
            };
        </script>
    </body>
</html>
